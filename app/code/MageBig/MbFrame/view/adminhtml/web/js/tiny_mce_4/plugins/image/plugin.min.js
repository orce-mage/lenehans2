!function(domGlobals){"use strict";var merger,global=tinymce.util.Tools.resolve("tinymce.PluginManager"),Settings_hasDimensions=function(editor){return!1!==editor.settings.image_dimensions},Settings_hasAdvTab=function(editor){return!0===editor.settings.image_advtab},Settings_getPrependUrl=function(editor){return editor.getParam("image_prepend_url","")},Settings_getClassList=function(editor){return editor.getParam("image_class_list")},Settings_hasDescription=function(editor){return!1!==editor.settings.image_description},Settings_hasImageTitle=function(editor){return!0===editor.settings.image_title},Settings_hasImageCaption=function(editor){return!0},Settings_getImageList=function(editor){return editor.getParam("image_list",!1)},Settings_hasUploadUrl=function(editor){return editor.getParam("images_upload_url",!1)},Settings_hasUploadHandler=function(editor){return editor.getParam("images_upload_handler",!1)},Settings_getUploadUrl=function(editor){return editor.getParam("images_upload_url")},Settings_getUploadHandler=function(editor){return editor.getParam("images_upload_handler")},Settings_getUploadBasePath=function(editor){return editor.getParam("images_upload_base_path")},Settings_getUploadCredentials=function(editor){return editor.getParam("images_upload_credentials")},Global=void 0!==domGlobals.window?domGlobals.window:Function("return this;")(),resolve=function(p,scope){return function(parts,scope){for(var o=null!=scope?scope:Global,i=0;i<parts.length&&null!=o;++i)o=o[parts[i]];return o}(p.split("."),scope)},Global$1_getOrDie=function(name,scope){var actual=function(name,scope){return resolve(name,scope)}(name,scope);if(null==actual)throw name+" not available on this browser";return actual},global$1=tinymce.util.Tools.resolve("tinymce.util.Promise"),global$2=tinymce.util.Tools.resolve("tinymce.util.Tools"),global$3=tinymce.util.Tools.resolve("tinymce.util.XHR"),parseIntAndGetMax=function(val1,val2){return Math.max(parseInt(val1,10),parseInt(val2,10))},Utils_getImageSize=function(url,callback){var img=domGlobals.document.createElement("img");function done(width,height){img.parentNode&&img.parentNode.removeChild(img),callback({width:width,height:height})}img.onload=function(){done(parseIntAndGetMax(img.width,img.clientWidth),parseIntAndGetMax(img.height,img.clientHeight))},img.onerror=function(){done(0,0)};var style=img.style;style.visibility="hidden",style.position="fixed",style.bottom=style.left="0px",style.width=style.height="auto",domGlobals.document.body.appendChild(img),img.src=url},Utils_buildListItems=function(inputList,itemCallback,startItems){return function appendItems(values,output){return output=output||[],global$2.each(values,(function(item){var menuItem={text:item.text||item.title};item.menu?menuItem.menu=appendItems(item.menu):(menuItem.value=item.value,itemCallback(menuItem)),output.push(menuItem)})),output}(inputList,startItems||[])},Utils_removePixelSuffix=function(value){return value&&(value=value.replace(/px$/,"")),value},Utils_addPixelSuffix=function(value){return value.length>0&&/^[0-9]+$/.test(value)&&(value+="px"),value},Utils_mergeMargins=function(css){if(css.margin){var splitMargin=css.margin.split(" ");switch(splitMargin.length){case 1:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[0],css["margin-bottom"]=css["margin-bottom"]||splitMargin[0],css["margin-left"]=css["margin-left"]||splitMargin[0];break;case 2:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[1],css["margin-bottom"]=css["margin-bottom"]||splitMargin[0],css["margin-left"]=css["margin-left"]||splitMargin[1];break;case 3:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[1],css["margin-bottom"]=css["margin-bottom"]||splitMargin[2],css["margin-left"]=css["margin-left"]||splitMargin[1];break;case 4:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[1],css["margin-bottom"]=css["margin-bottom"]||splitMargin[2],css["margin-left"]=css["margin-left"]||splitMargin[3]}delete css.margin}return css},Utils_createImageList=function(editor,callback){var imageList=Settings_getImageList(editor);"string"==typeof imageList?global$3.send({url:imageList,success:function(text){callback(JSON.parse(text))}}):"function"==typeof imageList?imageList(callback):callback(imageList)},Utils_waitLoadImage=function(editor,data,imgElm){function selectImage(){imgElm.onload=imgElm.onerror=null,editor.selection&&(editor.selection.select(imgElm),editor.nodeChanged())}imgElm.onload=function(){data.width||data.height||!Settings_hasDimensions(editor)||editor.dom.setAttribs(imgElm,{width:imgElm.clientWidth,height:imgElm.clientHeight}),selectImage()},imgElm.onerror=selectImage},Utils_blobToDataUri=function(blob){return new global$1((function(resolve,reject){var reader=new(Global$1_getOrDie("FileReader"));reader.onload=function(){resolve(reader.result)},reader.onerror=function(){reject(reader.error.message)},reader.readAsDataURL(blob)}))},global$4=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),hasOwnProperty=Object.prototype.hasOwnProperty,merge=(merger=function(old,nu){return nu},function(){for(var objects=new Array(arguments.length),i=0;i<objects.length;i++)objects[i]=arguments[i];if(0===objects.length)throw new Error("Can't merge zero objects");for(var ret={},j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject)hasOwnProperty.call(curObject,key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret}),DOM=global$4.DOM,getHspace=function(image){return image.style.marginLeft&&image.style.marginRight&&image.style.marginLeft===image.style.marginRight?Utils_removePixelSuffix(image.style.marginLeft):""},getVspace=function(image){return image.style.marginTop&&image.style.marginBottom&&image.style.marginTop===image.style.marginBottom?Utils_removePixelSuffix(image.style.marginTop):""},getBorder=function(image){return image.style.borderWidth?Utils_removePixelSuffix(image.style.borderWidth):""},getAttrib=function(image,name){return image.hasAttribute(name)?image.getAttribute(name):""},getStyle=function(image,name){return image.style[name]?image.style[name]:""},hasCaption=function(image){return null!==image.parentNode&&image.parentNode.classList.contains("img-lazy-wrap")?1:image.classList.contains("lazyload")?2:0},setAttrib=function(image,name,value){image.setAttribute(name,value)},wrapInFigure=function(image,data){var figureElm,imgurl=data.src,w=data.width,h=data.height,ratio=h/w;image.setAttribute("data-src",imgurl),image.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),image.setAttribute("width",w),image.setAttribute("height",h),1===data.caption&&(image.classList.add("media-lazy","lazyload"),figureElm=DOM.create("span",{class:"img-lazy-wrap",style:"padding-bottom:"+100*parseFloat(ratio.toFixed(5))+"%"}),DOM.insertAfter(figureElm,image),figureElm.appendChild(image)),2===data.caption&&image.classList.add("img-fluid","lazyload"),0===data.caption&&(image.setAttribute("src",imgurl),image.removeAttribute("data-src"))},removeFigure=function(image,data){var figureElm=image.parentNode,imgurl=image.getAttribute("data-src");imgurl||(imgurl=image.getAttribute("src")),null!==image.parentNode&&image.parentNode.classList.contains("img-lazy-wrap")&&(DOM.insertAfter(image,figureElm),DOM.remove(figureElm)),image.classList.contains("media-lazy")&&image.classList.contains("lazyload")?image.classList.remove("media-lazy","lazyload"):image.classList.remove("lazyload"),image.setAttribute("src",imgurl),image.setAttribute("width",data.width),image.setAttribute("height",data.height),image.removeAttribute("data-src")},normalizeStyle=function(image,normalizeCss){var attrValue=image.getAttribute("style"),value=normalizeCss(null!==attrValue?attrValue:"");value.length>0?(image.setAttribute("style",value),image.setAttribute("data-mce-style",value)):image.removeAttribute("style")},setSize=function(name,normalizeCss){return function(image,name,value){image.style[name]?(image.style[name]=Utils_addPixelSuffix(value),normalizeStyle(image,normalizeCss)):setAttrib(image,name,value)}},getSize=function(image,name){return image.style[name]?Utils_removePixelSuffix(image.style[name]):getAttrib(image,name)},setHspace=function(image,value){var pxValue=Utils_addPixelSuffix(value);image.style.marginLeft=pxValue,image.style.marginRight=pxValue},setVspace=function(image,value){var pxValue=Utils_addPixelSuffix(value);image.style.marginTop=pxValue,image.style.marginBottom=pxValue},setBorder=function(image,value){var pxValue=Utils_addPixelSuffix(value);image.style.borderWidth=pxValue},setBorderStyle=function(image,value){image.style.borderStyle=value},getStyleValue=function(normalizeCss,data){var image=domGlobals.document.createElement("img");return setAttrib(image,"style",data.style),(getHspace(image)||""!==data.hspace)&&setHspace(image,data.hspace),(getVspace(image)||""!==data.vspace)&&setVspace(image,data.vspace),(getBorder(image)||""!==data.border)&&setBorder(image,data.border),(function(image){return getStyle(image,"borderStyle")}(image)||""!==data.borderStyle)&&setBorderStyle(image,data.borderStyle),normalizeCss(image.getAttribute("style"))},read=function(normalizeCss,image){return{src:(e=image,t="src",e.hasAttribute("data-src")?e.getAttribute("data-src"):e.hasAttribute(t)?e.getAttribute(t):""),alt:getAttrib(image,"alt"),title:getAttrib(image,"title"),width:getSize(image,"width"),height:getSize(image,"height"),class:getAttrib(image,"class"),style:normalizeCss(getAttrib(image,"style")),caption:hasCaption(image),hspace:getHspace(image),vspace:getVspace(image),border:getBorder(image),borderStyle:getStyle(image,"borderStyle")};var e,t},updateProp=function(image,oldData,newData,name,set){newData[name]!==oldData[name]&&set(image,name,newData[name])},normalized=function(set,normalizeCss){return function(image,name,value){set(image,value),normalizeStyle(image,normalizeCss)}},write=function(normalizeCss,newData,image){var oldData=read(normalizeCss,image);updateProp(image,oldData,newData,"caption",(function(image,_name,_value){return function(image,data){hasCaption(image)?removeFigure(image,data):wrapInFigure(image,data)}(image,newData)})),newData.caption!==oldData.caption||image.hasAttribute("data-src")?(removeFigure(image,newData),wrapInFigure(image,newData)):(updateProp(image,oldData,newData,"src",setAttrib),updateProp(image,oldData,newData,"width",setSize(0,normalizeCss)),updateProp(image,oldData,newData,"height",setSize(0,normalizeCss))),updateProp(image,oldData,newData,"alt",setAttrib),updateProp(image,oldData,newData,"title",setAttrib),updateProp(image,oldData,newData,"class",setAttrib),updateProp(image,oldData,newData,"style",normalized((function(image,value){return setAttrib(image,"style",value)}),normalizeCss)),updateProp(image,oldData,newData,"hspace",normalized(setHspace,normalizeCss)),updateProp(image,oldData,newData,"vspace",normalized(setVspace,normalizeCss)),updateProp(image,oldData,newData,"border",normalized(setBorder,normalizeCss)),updateProp(image,oldData,newData,"borderStyle",normalized(setBorderStyle,normalizeCss))},normalizeCss=function(editor,cssText){var css=editor.dom.styles.parse(cssText),mergedCss=Utils_mergeMargins(css),compressed=editor.dom.styles.parse(editor.dom.styles.serialize(mergedCss));return editor.dom.styles.serialize(compressed)},getSelectedImage=function(editor){var imgElm=editor.selection.getNode(),figureElm=editor.dom.getParent(imgElm,".img-lazy-wrap");return figureElm?editor.dom.select("img",figureElm)[0]:imgElm&&("IMG"!==imgElm.nodeName||imgElm.getAttribute("data-mce-object")||imgElm.getAttribute("data-mce-placeholder"))?null:imgElm},readImageDataFromSelection=function(editor){var image=getSelectedImage(editor);return image?read((function(css){return normalizeCss(editor,css)}),image):{src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:0,hspace:"",vspace:"",border:"",borderStyle:""}},insertImageAtCaret=function(editor,data){var elm=function(normalizeCss,data){var image=domGlobals.document.createElement("img");if(write(normalizeCss,merge(data,{caption:0}),image),setAttrib(image,"alt",data.alt),data.caption){var imgurl=data.src;image.setAttribute("data-src",imgurl),image.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==");var figure,w=data.width?data.width:1,h=data.height?data.height:1;return 1===data.caption?(image.classList.add("media-lazy","lazyload"),(figure=DOM.create("span",{class:"img-lazy-wrap",style:"padding-bottom:"+Math.round(1e4*(h/w+Number.EPSILON))/100+"%"})).appendChild(image),figure):(image.classList.add("img-fluid","lazyload"),image)}return image}((function(css){return normalizeCss(editor,css)}),data);editor.dom.setAttrib(elm,"data-mce-id","__mcenew"),editor.focus(),editor.selection.setContent(elm.outerHTML);var insertedElm=editor.dom.select('*[data-mce-id="__mcenew"]')[0];editor.dom.setAttrib(insertedElm,"data-mce-id",null),function(elm){return elm.classList.contains("img-lazy-wrap")}(insertedElm)?editor.selection.select(insertedElm.parentNode):editor.selection.select(insertedElm)},insertOrUpdateImage=function(editor,data){var image=getSelectedImage(editor);image?data.src?function(editor,data){var image=getSelectedImage(editor);write((function(css){return normalizeCss(editor,css)}),data,image),function(editor,image){editor.dom.setAttrib(image,"src",image.getAttribute("src"))}(editor,image),editor.selection.select(image),Utils_waitLoadImage(editor,data,image)}(editor,data):function(editor,image){if(image){var elm=editor.dom.is(image.parentNode,".img-lazy-wrap")?image.parentNode:image;editor.dom.remove(elm),editor.focus(),editor.nodeChanged(),editor.dom.isEmpty(editor.getBody())&&(editor.setContent(""),editor.selection.setCursorLocation())}}(editor,image):data.src&&insertImageAtCaret(editor,data)},updateVSpaceHSpaceBorder=function(editor){return function(evt){var dom=editor.dom,rootControl=evt.control.rootControl;if(Settings_hasAdvTab(editor)){var data=rootControl.toJSON(),css=dom.parseStyle(data.style);rootControl.find("#vspace").value(""),rootControl.find("#hspace").value(""),((css=Utils_mergeMargins(css))["margin-top"]&&css["margin-bottom"]||css["margin-right"]&&css["margin-left"])&&(css["margin-top"]===css["margin-bottom"]?rootControl.find("#vspace").value(Utils_removePixelSuffix(css["margin-top"])):rootControl.find("#vspace").value(""),css["margin-right"]===css["margin-left"]?rootControl.find("#hspace").value(Utils_removePixelSuffix(css["margin-right"])):rootControl.find("#hspace").value("")),css["border-width"]?rootControl.find("#border").value(Utils_removePixelSuffix(css["border-width"])):rootControl.find("#border").value(""),css["border-style"]?rootControl.find("#borderStyle").value(css["border-style"]):rootControl.find("#borderStyle").value(""),rootControl.find("#style").value(dom.serializeStyle(dom.parseStyle(dom.serializeStyle(css))))}}},updateStyle=function(editor,win){win.find("#style").each((function(ctrl){var value=getStyleValue((function(css){return normalizeCss(editor,css)}),merge({src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:0,hspace:"",vspace:"",border:"",borderStyle:""},win.toJSON()));ctrl.value(value)}))},AdvTab_makeTab=function(editor){return{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:updateVSpaceHSpaceBorder(editor)},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,defaults:{type:"textbox",maxWidth:50,onchange:function(evt){updateStyle(editor,evt.control.rootControl)}},items:[{label:"Vertical space",name:"vspace"},{label:"Border width",name:"border"},{label:"Horizontal space",name:"hspace"},{label:"Border style",type:"listbox",name:"borderStyle",width:90,maxWidth:90,onselect:function(evt){updateStyle(editor,evt.control.rootControl)},values:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]}},doSyncSize=function(widthCtrl,heightCtrl){widthCtrl.state.set("oldVal",widthCtrl.value()),heightCtrl.state.set("oldVal",heightCtrl.value())},doSizeControls=function(win,f){var widthCtrl=win.find("#width")[0],heightCtrl=win.find("#height")[0],constrained=win.find("#constrain")[0];widthCtrl&&heightCtrl&&constrained&&f(widthCtrl,heightCtrl,constrained.checked()),jQuery(".mce-btn.mce-primary").css("pointer-events","")},doUpdateSize=function(widthCtrl,heightCtrl,isContrained){var oldWidth=widthCtrl.state.get("oldVal"),oldHeight=heightCtrl.state.get("oldVal"),newWidth=widthCtrl.value(),newHeight=heightCtrl.value();isContrained&&oldWidth&&oldHeight&&newWidth&&newHeight&&(newWidth!==oldWidth?(newHeight=Math.round(newWidth/oldWidth*newHeight),isNaN(newHeight)||heightCtrl.value(newHeight)):(newWidth=Math.round(newHeight/oldHeight*newWidth),isNaN(newWidth)||widthCtrl.value(newWidth))),doSyncSize(widthCtrl,heightCtrl)},updateSize=function(win){doSizeControls(win,doUpdateSize)},SizeManager_createUi=function(){var recalcSize=function(evt){updateSize(evt.control.rootControl)};return{type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:recalcSize,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:recalcSize,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}},SizeManager_syncSize=function(win){doSizeControls(win,doSyncSize)},SizeManager_updateSize=updateSize,onClassChange=function(evt,editor){var newValue,rootControl=evt.control.rootControl,checkCaption=rootControl.find("#caption").value(),currentValue=rootControl.find("#class").value(),currArr=[];if(currentValue&&(currArr=currentValue.trim().split(" ")),1===checkCaption){currArr.indexOf("media-lazy")<0&&currArr.push("media-lazy"),currArr.indexOf("lazyload")<0&&currArr.push("lazyload");var imgfluid=currArr.indexOf("img-fluid");-1!==imgfluid&&currArr.splice(imgfluid,1)}if(2===checkCaption&&(currArr.indexOf("img-fluid")<0&&currArr.push("img-fluid"),currArr.indexOf("lazyload")<0&&currArr.push("lazyload"),-1!==(index=currArr.indexOf("media-lazy"))&&currArr.splice(index,1)),0===checkCaption){var index;-1!==(index=currArr.indexOf("media-lazy"))&&currArr.splice(index,1);var index2=currArr.indexOf("lazyload");-1!==index2&&currArr.splice(index2,1)}newValue=currArr.join(" "),rootControl.find("#class").value(newValue)},onBeforeCall=function(evt){evt.meta=evt.control.rootControl.toJSON()},getGeneralItems=function(editor,imageListCtrl){var generalFormItems=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onPostRender:function(evt){var inputID=jQuery("#"+this._id).find("input");inputID.addClass("input-src"),inputID.on("change",(function(){!function(evt,editor){var srcURL,prependURL,absoluteURLPattern,meta=evt.meta||{},control=evt.control,rootControl=control.rootControl,imageListCtrl=rootControl.find("#image-list")[0];imageListCtrl&&imageListCtrl.value(editor.convertURL(control.value(),"src")),global$2.each(meta,(function(value,key){rootControl.find("#"+key).value(value)})),srcURL=editor.convertURL(control.value(),"src"),prependURL=Settings_getPrependUrl(editor),absoluteURLPattern=new RegExp("^(?:[a-z]+:)?//","i"),prependURL&&!absoluteURLPattern.test(srcURL)&&srcURL.substring(0,prependURL.length)!==prependURL&&(srcURL=prependURL+srcURL),control.value(srcURL),Utils_getImageSize(editor.documentBaseURI.toAbsolute(control.value()),(function(data){data.width&&data.height&&Settings_hasDimensions(editor)&&(rootControl.find("#width").value(data.width),rootControl.find("#height").value(data.height),SizeManager_syncSize(rootControl))}))}(evt,editor),jQuery("#src-lazy").attr("src",inputID.val())}))},onbeforecall:onBeforeCall},imageListCtrl];generalFormItems.push({name:"class",type:"textbox",label:"Image Class",onchange:function(evt){onClassChange(evt)}}),Settings_hasImageCaption(editor)&&generalFormItems.push({name:"caption",type:"listbox",label:"Active Lazy Load",values:[{text:"Off",value:0},{text:"Lazy load - Blur Effect",value:1},{text:"Lazy load - Auto Width",value:2}],onselect:function(evt){jQuery(".mce-btn.mce-primary").css("pointer-events","none"),jQuery(".input-src").trigger("change"),onClassChange(evt)}});var imgprev="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";return editor.selection.getNode().getAttribute("data-src")?imgprev=editor.selection.getNode().getAttribute("data-src"):editor.selection.getNode().getAttribute("src")&&(imgprev=editor.selection.getNode().getAttribute("src")),generalFormItems.push({name:"srcpreview",type:"container",label:"Lazy Preview",minHeight:160,style:"height: auto !important;",html:'<img id="src-lazy" style="width: 100%; height: 100%;object-fit: contain;" src="'+imgprev+'"/>'}),Settings_hasDescription(editor)&&generalFormItems.push({name:"alt",type:"textbox",label:"Image description"}),Settings_hasImageTitle(editor)&&generalFormItems.push({name:"title",type:"textbox",label:"Image Title"}),Settings_hasDimensions(editor)&&generalFormItems.push(SizeManager_createUi()),Settings_getClassList(editor)&&generalFormItems.push({name:"class",type:"listbox",label:"Class",values:Utils_buildListItems(Settings_getClassList(editor),(function(item){item.value&&(item.textStyle=function(){return editor.formatter.getCssText({inline:"img",classes:[item.value]})})}))}),generalFormItems},MainTab_makeTab=function(editor,imageListCtrl){return{title:"General",type:"form",items:getGeneralItems(editor,imageListCtrl)}},MainTab_getGeneralItems=getGeneralItems,url=function(){return Global$1_getOrDie("URL")},URL_createObjectURL=function(blob){return url().createObjectURL(blob)},URL_revokeObjectURL=function(u){url().revokeObjectURL(u)},global$5=tinymce.util.Tools.resolve("tinymce.ui.Factory"),noop=function(){};function Uploader(settings){var defaultHandler=function(blobInfo,success,failure,progress){var xhr,formData;(xhr=new(Global$1_getOrDie("XMLHttpRequest"))).open("POST",settings.url),xhr.withCredentials=settings.credentials,xhr.upload.onprogress=function(e){progress(e.loaded/e.total*100)},xhr.onerror=function(){failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status)},xhr.onload=function(){var json,path1,path2;xhr.status<200||xhr.status>=300?failure("HTTP Error: "+xhr.status):(json=JSON.parse(xhr.responseText))&&"string"==typeof json.location?success((path1=settings.basePath,path2=json.location,path1?path1.replace(/\/$/,"")+"/"+path2.replace(/^\//,""):path2)):failure("Invalid JSON: "+xhr.responseText)},(formData=new domGlobals.FormData).append("file",blobInfo.blob(),blobInfo.filename()),xhr.send(formData)};return settings=global$2.extend({credentials:!1,handler:defaultHandler},settings),{upload:function(blobInfo){return settings.url||settings.handler!==defaultHandler?function(blobInfo,handler){return new global$1((function(resolve,reject){try{handler(blobInfo,resolve,reject,noop)}catch(ex){reject(ex.message)}}))}(blobInfo,settings.handler):global$1.reject("Upload url missing from the settings.")}}}var onFileInput=function(editor){return function(evt){var Throbber=global$5.get("Throbber"),rootControl=evt.control.rootControl,throbber=new Throbber(rootControl.getEl()),file=evt.control.value(),blobUri=URL_createObjectURL(file),uploader=Uploader({url:Settings_getUploadUrl(editor),basePath:Settings_getUploadBasePath(editor),credentials:Settings_getUploadCredentials(editor),handler:Settings_getUploadHandler(editor)}),finalize=function(){throbber.hide(),URL_revokeObjectURL(blobUri)};return throbber.show(),Utils_blobToDataUri(file).then((function(dataUrl){var blobInfo=editor.editorUpload.blobCache.create({blob:file,blobUri:blobUri,name:file.name?file.name.replace(/\.[^\.]+$/,""):null,base64:dataUrl.split(",")[1]});return uploader.upload(blobInfo).then((function(url){var src=rootControl.find("#src");return src.value(url),rootControl.find("tabpanel")[0].activateTab(0),src.fire("change"),finalize(),url}))})).catch((function(err){editor.windowManager.alert(err),finalize()}))}},UploadTab_makeTab=function(editor){return{title:"Upload",type:"form",layout:"flex",direction:"column",align:"stretch",padding:"20 20 20 20",items:[{type:"container",layout:"flex",direction:"column",align:"center",spacing:10,items:[{text:"Browse for an image",type:"browsebutton",accept:".jpg,.jpeg,.png,.gif",onchange:onFileInput(editor)},{text:"OR",type:"label"}]},{text:"Drop an image here",type:"dropzone",accept:".jpg,.jpeg,.png,.gif",height:100,onchange:onFileInput(editor)}]}};function curry(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}var submitForm=function(editor,evt){var win=evt.control.getRoot();SizeManager_updateSize(win),editor.undoManager.transact((function(){var data=merge(readImageDataFromSelection(editor),win.toJSON());insertOrUpdateImage(editor,data)})),editor.editorUpload.uploadImagesAuto()};function Dialog(editor){function showDialog(imageList){var win,imageListCtrl,data=readImageDataFromSelection(editor);if(imageList&&(imageListCtrl={type:"listbox",label:"Image list",name:"image-list",values:Utils_buildListItems(imageList,(function(item){item.value=editor.convertURL(item.value||item.url,"src")}),[{text:"None",value:""}]),value:data.src&&editor.convertURL(data.src,"src"),onselect:function(e){var altCtrl=win.find("#alt");(!altCtrl.value()||e.lastControl&&altCtrl.value()===e.lastControl.text())&&altCtrl.value(e.control.text()),win.find("#src").value(e.control.value()).fire("change")},onPostRender:function(){imageListCtrl=this}}),Settings_hasAdvTab(editor)||Settings_hasUploadUrl(editor)||Settings_hasUploadHandler(editor)){var body=[MainTab_makeTab(editor,imageListCtrl)];Settings_hasAdvTab(editor)&&body.push(AdvTab_makeTab(editor)),(Settings_hasUploadUrl(editor)||Settings_hasUploadHandler(editor))&&body.push(UploadTab_makeTab(editor)),win=editor.windowManager.open({title:"Insert/edit image",data:data,bodyType:"tabpanel",body:body,onSubmit:curry(submitForm,editor)})}else win=editor.windowManager.open({title:"Insert/edit image",data:data,body:MainTab_getGeneralItems(editor,imageListCtrl),onSubmit:curry(submitForm,editor)});SizeManager_syncSize(win)}return{open:function(){Utils_createImageList(editor,showDialog)}}}var Commands_register=function(editor){editor.addCommand("mceImage",Dialog(editor).open)},Buttons_register=function(editor){editor.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:Dialog(editor).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),editor.addMenuItem("image",{icon:"image",text:"Image",onclick:Dialog(editor).open,context:"insert",prependToContext:!0})};global.add("image",(function(editor){Buttons_register(editor),Commands_register(editor)}))}(window);