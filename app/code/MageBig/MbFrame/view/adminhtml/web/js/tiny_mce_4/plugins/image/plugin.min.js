!function(t){"use strict";var e,n=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=function(t){return!1!==t.settings.image_dimensions},r=function(t){return!0===t.settings.image_advtab},i=function(t){return t.getParam("image_class_list")},o=function(t){return t.getParam("images_upload_url",!1)},l=function(t){return t.getParam("images_upload_handler",!1)},s=function(t){return t.getParam("images_upload_url")},c=function(t){return t.getParam("images_upload_handler")},u=function(t){return t.getParam("images_upload_base_path")},d=function(t){return t.getParam("images_upload_credentials")},g=void 0!==t.window?t.window:Function("return this;")(),m=function(t,e){var n=function(t,e){return function(t,e){return function(t,e){for(var n=null!=e?e:g,a=0;a<t.length&&null!=n;++a)n=n[t[a]];return n}(t.split("."),e)}(t,e)}(t,e);if(null==n)throw t+" not available on this browser";return n},p=tinymce.util.Tools.resolve("tinymce.util.Promise"),f=tinymce.util.Tools.resolve("tinymce.util.Tools"),h=tinymce.util.Tools.resolve("tinymce.util.XHR"),v=function(t,e){return Math.max(parseInt(t,10),parseInt(e,10))},y=function(t,e,n){return function t(n,a){return a=a||[],f.each(n,function(n){var r={text:n.text||n.title};n.menu?r.menu=t(n.menu):(r.value=n.value,e(r)),a.push(r)}),a}(t,n||[])},b=function(t){return t&&(t=t.replace(/px$/,"")),t},A=function(t){return t.length>0&&/^[0-9]+$/.test(t)&&(t+="px"),t},w=function(t){if(t.margin){var e=t.margin.split(" ");switch(e.length){case 1:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[0],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[0];break;case 2:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[1];break;case 3:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[1];break;case 4:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[3]}delete t.margin}return t},x=function(t,e){var n=function(t){return t.getParam("image_list",!1)}(t);"string"==typeof n?h.send({url:n,success:function(t){e(JSON.parse(t))}}):"function"==typeof n?n(e):e(n)},L=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),z=Object.prototype.hasOwnProperty,C=(e=function(t,e){return e},function(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];if(0===t.length)throw new Error("Can't merge zero objects");for(var a={},r=0;r<t.length;r++){var i=t[r];for(var o in i)z.call(i,o)&&(a[o]=e(a[o],i[o]))}return a}),N=L.DOM,S=function(t){return t.style.marginLeft&&t.style.marginRight&&t.style.marginLeft===t.style.marginRight?b(t.style.marginLeft):""},T=function(t){return t.style.marginTop&&t.style.marginBottom&&t.style.marginTop===t.style.marginBottom?b(t.style.marginTop):""},_=function(t){return t.style.borderWidth?b(t.style.borderWidth):""},R=function(t,e){return t.hasAttribute(e)?t.getAttribute(e):""},O=function(t,e){return t.style[e]?t.style[e]:""},P=function(t){return null!==t.parentNode&&t.parentNode.classList.contains("img-lazy-wrap")?1:null!==t.parentNode&&t.parentNode.classList.contains("img-native-wrap")?2:0},E=function(t,e,n){t.setAttribute(e,n)},I=function(t,e){var n,a=e.src,r=e.width,i=e.height,o=100*i/r,l=+(Math.round(o+"e+3")+"e-3");t.setAttribute("loading","lazy"),t.setAttribute("data-src",a),t.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),t.setAttribute("width",r),t.setAttribute("height",i),1===e.caption&&(t.classList.add("media-lazy","lazyload"),n=N.create("span",{class:"img-lazy-wrap",style:"padding-bottom:"+l+"%"}),t.removeAttribute("loading"),N.insertAfter(n,t),n.appendChild(t)),2===e.caption&&(t.setAttribute("loading","lazy"),t.setAttribute("src",a),t.removeAttribute("data-src"),t.classList.add("img-fluid"),n=N.create("span",{class:"img-native-wrap",style:"padding-bottom:"+l+"%"}),N.insertAfter(n,t),n.appendChild(t)),0===e.caption&&(t.setAttribute("src",a),t.removeAttribute("data-src"))},B=function(t,e){var n=t.parentNode,a=t.getAttribute("data-src");a||(a=t.getAttribute("src")),null!==t.parentNode&&t.parentNode.classList.contains("img-lazy-wrap")&&(N.insertAfter(t,n),N.remove(n)),null!==t.parentNode&&t.parentNode.classList.contains("img-native-wrap")&&(N.insertAfter(t,n),N.remove(n)),t.classList.contains("media-lazy")&&t.classList.contains("lazyload")?t.classList.remove("media-lazy","lazyload"):t.classList.remove("lazyload"),t.setAttribute("src",a),t.setAttribute("width",e.width),t.setAttribute("height",e.height),t.setAttribute("loading","lazy"),t.removeAttribute("data-src")},j=function(t,e){var n=t.getAttribute("style"),a=e(null!==n?n:"");a.length>0?(t.setAttribute("style",a),t.setAttribute("data-mce-style",a)):t.removeAttribute("style")},M=function(t,e){return function(t,n,a){t.style[n]?(t.style[n]=A(a),j(t,e)):E(t,n,a)}},U=function(t,e){return t.style[e]?b(t.style[e]):R(t,e)},H=function(t,e){var n=A(e);t.style.marginLeft=n,t.style.marginRight=n},k=function(t,e){var n=A(e);t.style.marginTop=n,t.style.marginBottom=n},D=function(t,e){var n=A(e);t.style.borderWidth=n},Q=function(t,e){t.style.borderStyle=e},W=function(t,e){return{src:(n=e,"src",n.hasAttribute("data-src")?n.getAttribute("data-src"):n.hasAttribute("src")?n.getAttribute("src"):""),alt:R(e,"alt"),title:R(e,"title"),width:U(e,"width"),height:U(e,"height"),class:R(e,"class"),style:t(R(e,"style")),caption:P(e),hspace:S(e),vspace:T(e),border:_(e),borderStyle:O(e,"borderStyle")};var n},J=function(t,e,n,a,r){n[a]!==e[a]&&r(t,a,n[a])},G=function(t,e){return function(n,a,r){t(n,r),j(n,e)}},V=function(t,e,n){var a=W(t,n);n.setAttribute("loading","lazy"),J(n,a,e,"caption",function(t,n,a){return function(t,e){P(t)?B(t,e):I(t,e)}(t,e)}),e.caption!==a.caption||n.hasAttribute("data-src")?(B(n,e),I(n,e)):(J(n,a,e,"src",E),J(n,a,e,"width",M(0,t)),J(n,a,e,"height",M(0,t))),J(n,a,e,"alt",E),J(n,a,e,"title",E),J(n,a,e,"class",E),J(n,a,e,"style",G(function(t,e){return E(t,"style",e)},t)),J(n,a,e,"hspace",G(H,t)),J(n,a,e,"vspace",G(k,t)),J(n,a,e,"border",G(D,t)),J(n,a,e,"borderStyle",G(Q,t))},F=function(t,e){var n=t.dom.styles.parse(e),a=w(n),r=t.dom.styles.parse(t.dom.styles.serialize(a));return t.dom.styles.serialize(r)},$=function(t){var e=t.selection.getNode(),n=t.dom.getParent(e,".img-lazy-wrap")?t.dom.getParent(e,".img-lazy-wrap"):t.dom.getParent(e,".img-native-wrap");return n?t.dom.select("img",n)[0]:e&&("IMG"!==e.nodeName||e.getAttribute("data-mce-object")||e.getAttribute("data-mce-placeholder"))?null:e},K=function(t){var e=$(t);return e?W(function(e){return F(t,e)},e):{src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:0,hspace:"",vspace:"",border:"",borderStyle:""}},X=function(e,n){var r=$(e);r?n.src?function(t,e){var n=$(t);V(function(e){return F(t,e)},e,n),function(t,e){t.dom.setAttrib(e,"src",e.getAttribute("src"))}(t,n),t.selection.select(n),function(t,e,n){function r(){n.onload=n.onerror=null,t.selection&&(t.selection.select(n),t.nodeChanged())}n.onload=function(){e.width||e.height||!a(t)||t.dom.setAttribs(n,{width:n.clientWidth,height:n.clientHeight}),r()},n.onerror=r}(t,e,n)}(e,n):function(t,e){if(e){var n=t.dom.is(e.parentNode,".img-lazy-wrap")||t.dom.is(e.parentNode,".img-native-wrap")?e.parentNode:e;t.dom.remove(n),t.focus(),t.nodeChanged(),t.dom.isEmpty(t.getBody())&&(t.setContent(""),t.selection.setCursorLocation())}}(e,r):n.src&&function(e,n){var a=function(e,n){var a=t.document.createElement("img");if(V(e,C(n,{caption:0}),a),E(a,"alt",n.alt),n.caption){var r=n.src;1===n.caption&&(a.setAttribute("data-src",r),a.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==")),2===n.caption&&a.setAttribute("loading","lazy");var i,o=n.width?n.width:1,l=100*(n.height?n.height:1)/o,s=+(Math.round(l+"e+3")+"e-3");return 1===n.caption?(a.classList.add("media-lazy","lazyload"),(i=N.create("span",{class:"img-lazy-wrap",style:"padding-bottom:"+s+"%"})).appendChild(a),i):2===n.caption?(a.classList.add("img-fluid"),(i=N.create("span",{class:"img-native-wrap",style:"padding-bottom:"+s+"%"})).appendChild(a),i):(a.classList.add("img-fluid"),a)}return a}(function(t){return F(e,t)},n);e.dom.setAttrib(a,"data-mce-id","__mcenew"),e.focus(),e.selection.setContent(a.outerHTML);var r=e.dom.select('*[data-mce-id="__mcenew"]')[0];e.dom.setAttrib(r,"data-mce-id",null),function(t){return t.classList.contains("img-lazy-wrap")?t.classList.contains("img-lazy-wrap"):t.classList.contains("img-native-wrap")}(r)?e.selection.select(r.parentNode):e.selection.select(r)}(e,n)},q=function(t){return function(e){var n=t.dom,a=e.control.rootControl;if(r(t)){var i=a.toJSON(),o=n.parseStyle(i.style);a.find("#vspace").value(""),a.find("#hspace").value(""),((o=w(o))["margin-top"]&&o["margin-bottom"]||o["margin-right"]&&o["margin-left"])&&(o["margin-top"]===o["margin-bottom"]?a.find("#vspace").value(b(o["margin-top"])):a.find("#vspace").value(""),o["margin-right"]===o["margin-left"]?a.find("#hspace").value(b(o["margin-right"])):a.find("#hspace").value("")),o["border-width"]?a.find("#border").value(b(o["border-width"])):a.find("#border").value(""),o["border-style"]?a.find("#borderStyle").value(o["border-style"]):a.find("#borderStyle").value(""),a.find("#style").value(n.serializeStyle(n.parseStyle(n.serializeStyle(o))))}}},Y=function(e,n){n.find("#style").each(function(a){var r=function(e,n){var a=t.document.createElement("img");return E(a,"style",n.style),(S(a)||""!==n.hspace)&&H(a,n.hspace),(T(a)||""!==n.vspace)&&k(a,n.vspace),(_(a)||""!==n.border)&&D(a,n.border),(function(t){return O(t,"borderStyle")}(a)||""!==n.borderStyle)&&Q(a,n.borderStyle),e(a.getAttribute("style"))}(function(t){return F(e,t)},C({src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:0,hspace:"",vspace:"",border:"",borderStyle:""},n.toJSON()));a.value(r)})},Z=function(t){return{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:q(t)},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,defaults:{type:"textbox",maxWidth:50,onchange:function(e){Y(t,e.control.rootControl)}},items:[{label:"Vertical space",name:"vspace"},{label:"Border width",name:"border"},{label:"Horizontal space",name:"hspace"},{label:"Border style",type:"listbox",name:"borderStyle",width:90,maxWidth:90,onselect:function(e){Y(t,e.control.rootControl)},values:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]}},tt=function(t,e){t.state.set("oldVal",t.value()),e.state.set("oldVal",e.value())},et=function(t,e){var n=t.find("#width")[0],a=t.find("#height")[0],r=t.find("#constrain")[0];n&&a&&r&&e(n,a,r.checked()),jQuery(".mce-btn.mce-primary").css("pointer-events","")},nt=function(t,e,n){var a=t.state.get("oldVal"),r=e.state.get("oldVal"),i=t.value(),o=e.value();n&&a&&r&&i&&o&&(i!==a?(o=Math.round(i/a*o),isNaN(o)||e.value(o)):(i=Math.round(o/r*i),isNaN(i)||t.value(i))),tt(t,e)},at=function(t){et(t,nt)},rt=function(t){et(t,tt)},it=at,ot=function(t,e){var n=t.control.rootControl,a=n.find("#class");1===n.find("#caption").value()?a.value("media-lazy lazyload"):a.value("img-fluid")},lt=function(t){t.meta=t.control.rootControl.toJSON()},st=function(e,n){var r=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onPostRender:function(n){var r=jQuery("#"+this._id).find("input");r.addClass("input-src"),r.on("change",function(){!function(e,n){var r,i,o,l=e.meta||{},s=e.control,c=s.rootControl,u=c.find("#image-list")[0];u&&u.value(n.convertURL(s.value(),"src")),f.each(l,function(t,e){c.find("#"+e).value(t)}),r=n.convertURL(s.value(),"src"),i=function(t){return t.getParam("image_prepend_url","")}(n),o=new RegExp("^(?:[a-z]+:)?//","i"),i&&!o.test(r)&&r.substring(0,i.length)!==i&&(r=i+r),s.value(r),function(e,n){var a=t.document.createElement("img");function r(t,e){a.parentNode&&a.parentNode.removeChild(a),n({width:t,height:e})}a.onload=function(){r(v(a.width,a.clientWidth),v(a.height,a.clientHeight))},a.onerror=function(){r(0,0)};var i=a.style;i.visibility="hidden",i.position="fixed",i.bottom=i.left="0px",i.width=i.height="auto",t.document.body.appendChild(a),a.src=e}(n.documentBaseURI.toAbsolute(s.value()),function(t){t.width&&t.height&&a(n)&&(c.find("#width").value(t.width),c.find("#height").value(t.height),rt(c))})}(n,e),jQuery("#src-lazy").attr("src",r.val())})},onbeforecall:lt},n];r.push({name:"class",type:"textbox",label:"Image Class",onchange:function(t){ot(t)}}),r.push({name:"caption",type:"listbox",label:"Active Lazy Load",values:[{text:"Off",value:0},{text:"Lazy load - Light Effect",value:1},{text:"Native lazy load",value:2}],onselect:function(t){jQuery(".mce-btn.mce-primary").css("pointer-events","none"),jQuery(".input-src").trigger("change"),ot(t)}});var o,l="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";return e.selection.getNode().getAttribute("data-src")?l=e.selection.getNode().getAttribute("data-src"):e.selection.getNode().getAttribute("src")&&(l=e.selection.getNode().getAttribute("src")),r.push({name:"srcpreview",type:"container",label:"Lazy Preview",minHeight:160,style:"height: auto !important;",html:'<img id="src-lazy" style="width: 100%; height: 100%;object-fit: contain;" src="'+l+'"/>'}),function(t){return!1!==t.settings.image_description}(e)&&r.push({name:"alt",type:"textbox",label:"Image description"}),function(t){return!0===t.settings.image_title}(e)&&r.push({name:"title",type:"textbox",label:"Image Title"}),a(e)&&r.push({type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:o=function(t){at(t.control.rootControl)},ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:o,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}),i(e)&&r.push({name:"class",type:"listbox",label:"Class",values:y(i(e),function(t){t.value&&(t.textStyle=function(){return e.formatter.getCssText({inline:"img",classes:[t.value]})})})}),r},ct=function(t,e){return{title:"General",type:"form",items:st(t,e)}},ut=st,dt=function(){return m("URL")},gt=tinymce.util.Tools.resolve("tinymce.ui.Factory"),mt=function(){};var pt=function(e){return function(n){var a,r,i,o=gt.get("Throbber"),l=n.control.rootControl,g=new o(l.getEl()),h=n.control.value(),v=(i=h,dt().createObjectURL(i)),y=(a={url:s(e),basePath:u(e),credentials:d(e),handler:c(e)},r=function(e,n,r,i){var o,l;(o=new(m("XMLHttpRequest"))).open("POST",a.url),o.withCredentials=a.credentials,o.upload.onprogress=function(t){i(t.loaded/t.total*100)},o.onerror=function(){r("Image upload failed due to a XHR Transport error. Code: "+o.status)},o.onload=function(){var t,e,i;o.status<200||o.status>=300?r("HTTP Error: "+o.status):(t=JSON.parse(o.responseText))&&"string"==typeof t.location?n((e=a.basePath,i=t.location,e?e.replace(/\/$/,"")+"/"+i.replace(/^\//,""):i)):r("Invalid JSON: "+o.responseText)},(l=new t.FormData).append("file",e.blob(),e.filename()),o.send(l)},a=f.extend({credentials:!1,handler:r},a),{upload:function(t){return a.url||a.handler!==r?function(t,e){return new p(function(n,a){try{e(t,n,a,mt)}catch(t){a(t.message)}})}(t,a.handler):p.reject("Upload url missing from the settings.")}}),b=function(){var t;g.hide(),t=v,dt().revokeObjectURL(t)};return g.show(),function(t){return new p(function(e,n){var a=new(m("FileReader"));a.onload=function(){e(a.result)},a.onerror=function(){n(a.error.message)},a.readAsDataURL(t)})}(h).then(function(t){var n=e.editorUpload.blobCache.create({blob:h,blobUri:v,name:h.name?h.name.replace(/\.[^\.]+$/,""):null,base64:t.split(",")[1]});return y.upload(n).then(function(t){var e=l.find("#src");return e.value(t),l.find("tabpanel")[0].activateTab(0),e.fire("change"),b(),t})}).catch(function(t){e.windowManager.alert(t),b()})}},ft=function(t){return{title:"Upload",type:"form",layout:"flex",direction:"column",align:"stretch",padding:"20 20 20 20",items:[{type:"container",layout:"flex",direction:"column",align:"center",spacing:10,items:[{text:"Browse for an image",type:"browsebutton",accept:".jpg,.jpeg,.png,.gif",onchange:pt(t)},{text:"OR",type:"label"}]},{text:"Drop an image here",type:"dropzone",accept:".jpg,.jpeg,.png,.gif",height:100,onchange:pt(t)}]}};function ht(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];var r=e.concat(n);return t.apply(null,r)}}var vt=function(t,e){var n=e.control.getRoot();it(n),t.undoManager.transact(function(){var e=C(K(t),n.toJSON());X(t,e)}),t.editorUpload.uploadImagesAuto()};function yt(t){function e(e){var n,a,i=K(t);if(e&&(a={type:"listbox",label:"Image list",name:"image-list",values:y(e,function(e){e.value=t.convertURL(e.value||e.url,"src")},[{text:"None",value:""}]),value:i.src&&t.convertURL(i.src,"src"),onselect:function(t){var e=n.find("#alt");(!e.value()||t.lastControl&&e.value()===t.lastControl.text())&&e.value(t.control.text()),n.find("#src").value(t.control.value()).fire("change")},onPostRender:function(){a=this}}),r(t)||o(t)||l(t)){var s=[ct(t,a)];r(t)&&s.push(Z(t)),(o(t)||l(t))&&s.push(ft(t)),n=t.windowManager.open({title:"Insert/edit image",data:i,bodyType:"tabpanel",body:s,onSubmit:ht(vt,t)})}else n=t.windowManager.open({title:"Insert/edit image",data:i,body:ut(t,a),onSubmit:ht(vt,t)});rt(n)}return{open:function(){x(t,e)}}}n.add("image",function(t){(function(t){t.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:yt(t).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),t.addMenuItem("image",{icon:"image",text:"Image",onclick:yt(t).open,context:"insert",prependToContext:!0})})(t),function(t){t.addCommand("mceImage",yt(t).open)}(t)})}(window);
