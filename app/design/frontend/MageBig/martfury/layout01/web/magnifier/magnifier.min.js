!function($){function Magnify(element,options){var $thumb,customUserOptions=options||{},$box=$(element),that=this,largeWrapper=options.largeWrapper||".magnifier-preview",$magnifierPreview=$(largeWrapper);curThumb=null,magnifierOptions={x:0,y:0,w:0,h:0,lensW:0,lensH:0,lensBgX:0,lensBgY:0,largeW:0,largeH:0,largeL:0,largeT:0,zoom:2,zoomMin:1.1,zoomMax:5,mode:"outside",eventType:"click",status:0,zoomAttached:!1,zoomable:void 0!==customUserOptions.zoomable&&customUserOptions.zoomable,onthumbenter:void 0!==customUserOptions.onthumbenter?customUserOptions.onthumbenter:null,onthumbmove:void 0!==customUserOptions.onthumbmove?customUserOptions.onthumbmove:null,onthumbleave:void 0!==customUserOptions.onthumbleave?customUserOptions.onthumbleave:null,onzoom:void 0!==customUserOptions.onzoom?customUserOptions.onzoom:null},pos={t:0,l:0,x:0,y:0},gId=0,status=0,curIdx="",curLens=null,curLarge=null,lensbg=void 0===customUserOptions.bg||customUserOptions.lensbg,gZoom=void 0!==customUserOptions.zoom?customUserOptions.zoom:magnifierOptions.zoom,gZoomMin=void 0!==customUserOptions.zoomMin?customUserOptions.zoomMin:magnifierOptions.zoomMin,gZoomMax=void 0!==customUserOptions.zoomMax?customUserOptions.zoomMax:magnifierOptions.zoomMax,gMode=customUserOptions.mode||magnifierOptions.mode,gEventType=customUserOptions.eventType||magnifierOptions.eventType,data={},inBounds=!1,isOverThumb=!1,rate=1,paddingX=0,paddingY=0,enabled=!0,showWrapper=!0;var MagnifyCls_magnifyHidden="magnify-hidden",MagnifyCls_magnifyOpaque="magnify-opaque";function _toBoolean(str){if("string"==typeof str){if("true"===str)return!0;if("false"===str)return!1;console.warn("Wrong type: can't be transformed to Boolean")}else if("boolean"==typeof str)return str}function updateLensOnLoad(idSelectorMainImg,thumb,largeImgInMagnifyLens,largeWrapper){var textWrapper,magnifyLensElement=$box.find(".magnify-lens");1===data[idSelectorMainImg].status?(textWrapper=$('<div class="magnifier-loader-text"></div>'),magnifyLensElement.className="magnifier-loader magnify-hidden",textWrapper.html("Loading..."),magnifyLensElement.html("").append(textWrapper)):2===data[idSelectorMainImg].status&&(magnifyLensElement.addClass(MagnifyCls_magnifyHidden),magnifyLensElement.html(""),largeImgInMagnifyLens.id=idSelectorMainImg+"-large",largeImgInMagnifyLens.style.width=data[idSelectorMainImg].largeImgInMagnifyLensWidth+"px",largeImgInMagnifyLens.style.height=data[idSelectorMainImg].largeImgInMagnifyLensHeight+"px",largeImgInMagnifyLens.className="magnifier-large magnify-hidden","inside"===data[idSelectorMainImg].mode?magnifyLensElement.append(largeImgInMagnifyLens):largeWrapper.html("").append(largeImgInMagnifyLens)),data[idSelectorMainImg].lensH=data[idSelectorMainImg].lensH>$thumb.height()?$thumb.height():data[idSelectorMainImg].lensH,0===Math.round(data[idSelectorMainImg].lensW)?magnifyLensElement.css("display","none"):magnifyLensElement.css({width:Math.round(data[idSelectorMainImg].lensW)+"px",height:Math.round(data[idSelectorMainImg].lensH)+"px",display:""})}function getMousePos(){var t,l,xPos=pos.x-magnifierOptions.x,yPos=pos.y-magnifierOptions.y;inBounds=!(xPos<0||yPos<0||xPos>magnifierOptions.w||yPos>magnifierOptions.h),l=xPos-magnifierOptions.lensW/2,t=yPos-magnifierOptions.lensH/2,xPos<magnifierOptions.lensW/2&&(l=0),yPos<magnifierOptions.lensH/2&&(t=0),xPos-magnifierOptions.w+Math.ceil(magnifierOptions.lensW/2)>0&&(l=magnifierOptions.w-Math.ceil(magnifierOptions.lensW+2)),yPos-magnifierOptions.h+Math.ceil(magnifierOptions.lensH/2)>0&&(t=magnifierOptions.h-Math.ceil(magnifierOptions.lensH)),pos.l=l,pos.t=t,magnifierOptions.lensBgX=pos.l,magnifierOptions.lensBgY=pos.t,"inside"===magnifierOptions.mode?(magnifierOptions.largeL=Math.round(xPos*(magnifierOptions.zoom-magnifierOptions.lensW/magnifierOptions.w)),magnifierOptions.largeT=Math.round(yPos*(magnifierOptions.zoom-magnifierOptions.lensH/magnifierOptions.h))):(magnifierOptions.largeL=Math.round(magnifierOptions.lensBgX*magnifierOptions.zoom*(magnifierOptions.largeWrapperW/magnifierOptions.w)),magnifierOptions.largeT=Math.round(magnifierOptions.lensBgY*magnifierOptions.zoom*(magnifierOptions.largeWrapperH/magnifierOptions.h)))}function onThumbEnter(){_toBoolean(enabled)&&(magnifierOptions=data[curIdx],curLens=$box.find(".magnify-lens"),2===magnifierOptions.status?(curLens.removeClass(MagnifyCls_magnifyOpaque),curLarge=$("#"+curIdx+"-large"),curLarge.removeClass(MagnifyCls_magnifyHidden)):1===magnifierOptions.status&&(curLens.className="magnifier-loader"))}function onThumbLeave(){if(magnifierOptions.status>0){var handler=magnifierOptions.onthumbleave;null!==handler&&handler({thumb:curThumb,lens:curLens,large:curLarge,x:pos.x,y:pos.y}),curLens.hasClass(MagnifyCls_magnifyHidden)||(curLens.addClass(MagnifyCls_magnifyHidden),null!==curLarge&&curLarge.addClass(MagnifyCls_magnifyHidden))}}function move(){if(_toBoolean(enabled)){if(status!==magnifierOptions.status&&onThumbEnter(),magnifierOptions.status>0){curThumb.className=magnifierOptions.thumbCssClass+" magnify-opaque",1===magnifierOptions.status?curLens.className="magnifier-loader":2===magnifierOptions.status&&(curLens.removeClass(MagnifyCls_magnifyHidden),curLarge.removeClass(MagnifyCls_magnifyHidden),curLarge.css({left:"-"+magnifierOptions.largeL+"px",top:"-"+magnifierOptions.largeT+"px"}));pos.t=pos.t<=0?0:pos.t-2,curLens.css({left:pos.l+paddingX+"px",top:pos.t+paddingY+"px"}),lensbg?curLens.css({"background-color":"rgba(f,f,f,.5)"}):curLens.get(0).style.backgroundPosition="-"+magnifierOptions.lensBgX+"px -"+magnifierOptions.lensBgY+"px";var handler=magnifierOptions.onthumbmove;null!==handler&&handler({thumb:curThumb,lens:curLens,large:curLarge,x:pos.x,y:pos.y})}status=magnifierOptions.status}}function setThumbData(mainImage,mainImageData){var thumbBounds=mainImage.getBoundingClientRect(),w=0,h=0;mainImageData.x=Math.round(thumbBounds.left),mainImageData.y=Math.round(thumbBounds.top),mainImageData.w=Math.round(thumbBounds.right-mainImageData.x),mainImageData.h=Math.round(thumbBounds.bottom-mainImageData.y),"inside"===mainImageData.mode?(w=mainImageData.w,h=mainImageData.h):(w=mainImageData.largeWrapperW,h=mainImageData.largeWrapperH),mainImageData.largeImgInMagnifyLensWidth=Math.round(mainImageData.zoom*w),mainImageData.largeImgInMagnifyLensHeight=Math.round(mainImageData.zoom*h),mainImageData.lensW=Math.round(mainImageData.w/mainImageData.zoom),mainImageData.lensH=Math.round(mainImageData.h/mainImageData.zoom)}function _init($box,options){var opts={};if(void 0===options.thumb)return!1;if(($thumb=$box.find(options.thumb)).length){for(var key in options)opts[key]=options[key];opts.thumb=$thumb,enabled=opts.enabled,_toBoolean(enabled)?($magnifierPreview.show().css("display",""),$magnifierPreview.addClass(MagnifyCls_magnifyHidden),function(options){if(void 0!==data[options.thumb.id])return curThumb=options.thumb,!1;var largeUrl,thumbObj=new Image,largeObj=new Image,$thumb=options.thumb,thumb=$thumb.get(0),idx=thumb.id,largeWrapper=$(options.largeWrapper),zoom=options.zoom||thumb.getAttribute("data-zoom")||gZoom,zoomMin=options.zoomMin||gZoomMin,zoomMax=options.zoomMax||gZoomMax,mode=options.mode||thumb.getAttribute("data-mode")||gMode,eventType=options.eventType||thumb.getAttribute("data-eventType")||gEventType,onthumbenter=void 0!==options.onthumbenter?options.onthumbenter:magnifierOptions.onthumbenter,onthumbleave=void 0!==options.onthumbleave?options.onthumbleave:magnifierOptions.onthumbleave,onthumbmove=void 0!==options.onthumbmove?options.onthumbmove:magnifierOptions.onthumbmove;largeUrl=$thumb.data("original")||customUserOptions.full||$thumb.attr("src"),""===thumb.id&&(idx=thumb.id="magnifier-item-"+gId,gId+=1);(function(thumb){if($(thumb).siblings(".magnify-lens").length)return!1;var lens=$('<div class="magnify-lens magnify-hidden" data-gallery-role="magnifier-zoom"></div>');$(thumb).parent().append(lens)})(thumb),options.width&&largeWrapper.width(options.width);options.height&&largeWrapper.height(options.height);if(options.top){if("function"==typeof options.top)var top=options.top()+"px";else top=options.top+"px";largeWrapper.length&&(largeWrapper[0].style.top=top.replace("%px","%"))}if(options.left){if("function"==typeof options.left)var left=options.left()+"px";else left=options.left+"px";largeWrapper.length&&(largeWrapper[0].style.left=left.replace("%px","%"))}data[idx]={zoom:zoom,zoomMin:zoomMin,zoomMax:zoomMax,mode:mode,eventType:eventType,thumbCssClass:thumb.className,zoomAttached:!1,status:0,largeUrl:largeUrl,largeWrapperId:"outside"===mode?largeWrapper.attr("id"):null,largeWrapperW:"outside"===mode?largeWrapper.width():null,largeWrapperH:"outside"===mode?largeWrapper.height():null,onthumbenter:onthumbenter,onthumbleave:onthumbleave,onthumbmove:onthumbmove},paddingX=($thumb.parent().width()-$thumb.width())/2,paddingY=($thumb.parent().height()-$thumb.height())/2,showWrapper=!1,$(thumbObj).on("load",(function(){data[idx].status=1,$(largeObj).on("load",(function(){(largeObj.width>largeWrapper.width()||largeObj.height>largeWrapper.height())&&(showWrapper=!0,function(eType,thumb){switch(eType){case"hover":!function(thumb){$(thumb).on("mouseover",(function(e){showWrapper&&(0!==magnifierOptions.status&&onThumbLeave(),handleEvents(e),isOverThumb=inBounds)}))}(thumb);break;case"click":!function(thumb){$(thumb).on("click",(function(e){showWrapper&&(isOverThumb||(0!==magnifierOptions.status&&onThumbLeave(),handleEvents(e),isOverThumb=!0))}))}(thumb)}}(eventType,thumb),data[idx].status=2,largeObj.width>largeObj.height?data[idx].zoom=largeObj.width/largeWrapper.width():data[idx].zoom=largeObj.height/largeWrapper.height(),setThumbData(thumb,data[idx]),updateLensOnLoad(idx,0,largeObj,largeWrapper))})),largeObj.src=data[idx].largeUrl})),thumbObj.src=thumb.src}(opts)):$magnifierPreview.empty().hide()}return that}function handleEvents(e){var src=e.target;curIdx=src.id,curThumb=src,onThumbEnter(),setThumbData(curThumb,magnifierOptions),pos.x=e.clientX,pos.y=e.clientY,getMousePos(),move();var handler=magnifierOptions.onthumbenter;null!==handler&&handler({thumb:curThumb,lens:curLens,large:curLarge,x:pos.x,y:pos.y})}that.update=function(){updateLensOnLoad()},that.init=function(){_init($box,options)},$(window).on("scroll",(function(){null!==curThumb&&setThumbData(curThumb,magnifierOptions)})),$(window).resize((function(){_init($box,customUserOptions)})),$box.on("mousemove",(function(e){pos.x=e.clientX,pos.y=e.clientY,getMousePos(),"hover"===gEventType&&(isOverThumb=inBounds),inBounds&&isOverThumb&&"outside"===gMode&&($magnifierPreview.removeClass(MagnifyCls_magnifyHidden),move())})),$box.on("mouseleave",(function(){onThumbLeave(),isOverThumb=!1,$magnifierPreview.addClass(MagnifyCls_magnifyHidden)})),_init($box,customUserOptions)}$.fn.magnify=function(options){"use strict";return new Magnify($(this),options)}}(jQuery);